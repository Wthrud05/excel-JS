(function(){"use strict";var __webpack_modules__={781:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){function parse(value=""){if(value.startsWith("="))try{return eval(value.slice(1))}catch(t){return value}return value}__webpack_require__.d(__webpack_exports__,{Q:function(){return parse}})}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var r=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=function(t,e){for(var r in e)__webpack_require__.o(e,r)&&!__webpack_require__.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};var __webpack_exports__={};!function(){class t{constructor(t){this.$el="string"==typeof t?document.querySelector(t):t}html(t){return"string"==typeof t?(this.$el.innerHTML=t,this):this.$el.outerHTML()}clear(){return this.html(""),this}text(t){return void 0!==t?(this.$el.textContent=t,this):"input"===this.$el.tagName.toLowerCase()?this.$el.value.trim():this.$el.textContent.trim()}on(t,e){this.$el.addEventListener(t,e)}off(t,e){this.$el.removeEventListener(t,e)}find(t){return e(this.$el.querySelector(t))}append(e){return e instanceof t&&(e=e.$el),Element.prototype.append?this.$el.append(e):this.$el.appendChild(e),this}get data(){return this.$el.dataset}closest(t){return e(this.$el.closest(t))}getCoords(){return this.$el.getBoundingClientRect()}findAll(t){return this.$el.querySelectorAll(t)}css(t={}){Object.keys(t).forEach((e=>this.$el.style[e]=t[e]))}getStyles(t=[]){return t.reduce(((t,e)=>(t[e]=this.$el.style[e],t)),{})}attr(t,e){return e?(this.$el.setAttribute(t,e),this):this.$el.getAttribute(t)}addClass(t){return this.$el.classList.add(t),this}removeClass(t){return this.$el.classList.remove(t),this}id(t){if(t){const t=this.id().split(":");return{row:+t[0],col:+t[1]}}return this.data.id}focus(){return this.$el.focus(),this}}function e(e){return new t(e)}e.create=(t,r="")=>{const n=document.createElement(t);return r&&n.classList.add(r),e(n)};class r{static get path(){return window.location.hash.slice(1)}static get param(){return r.path.split("/")[1]}static navigate(t){window.location.hash=t}}function n(){return e.create("div","loader").html('\n  <div class="lds-spinner">\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n    <div></div>\n  </div>')}class i{constructor(t){this.params=t||Date.now().toString()}getRoot(){throw new Error('Method "getRoot" should be implemented')}afterRender(){}destroy(){}}function s(t,e){return t>e&&([e,t]=[t,e]),new Array(e-t+1).fill("").map(((e,r)=>t+r))}function o(t,e=null){if(!e)return JSON.parse(localStorage.getItem(t));localStorage.setItem(t,JSON.stringify(e))}function a(t,e){let r;return function(...n){clearTimeout(r),r=setTimeout((()=>{clearTimeout(r),t.apply(this,n)}),e)}}function c(t){t.preventDefault()}function l(t){const e=o(t);return`\n    <li class="db__record">\n      <a href="#excel/${t.split(":")[1]}">${e.title}</a>\n      <strong>\n        ${new Date(e.openedDate).toLocaleDateString()}\n        ${new Date(e.openedDate).toLocaleTimeString()}\n      </strong>\n    </li>\n  `}const u="TABLE_RESIZE",h="CHANGE_TEXT",d="APPLY_STYLE",p="CHANGE_STYLES",f="CHANGE_TITLE",v="UPDATE_DATE";function m(t,e){let r,n;switch(e.type){case u:return r="col"===e.data.type?"colState":"rowState",{...t,[r]:b(t,r,e)};case h:return r="dataState",{...t,currentText:e.data.value,[r]:b(t,r,e)};case p:return{...t,currentStyles:e.data};case d:return r="stylesState",n=t[r]||{},e.data.ids.forEach((t=>{n[t]={...n[t],...e.data.value}})),{...t,[r]:n,currentStyles:{...t.currentStyles,...e.data.value}};case f:return{...t,title:e.data};case v:return{...t,openedDate:(new Date).toJSON()};default:return t}}function b(t,e,r){const n=t[e]||{};return n[r.data.id]=r.data.value,n}const g={textAlign:"left",fontWeight:"normal",fontStyle:"normal",textDecoration:"none"},_="Новая таблица",y={title:_,rowState:{},colState:{},dataState:{},stylesState:{},currentText:"",currentStyles:g,openedDate:(new Date).toJSON()};class w{constructor(){this.listeners={}}emit(t,...e){return!!Array.isArray(this.listeners[t])&&(this.listeners[t].forEach((t=>{t(...e)})),!0)}subscribe(t,e){return this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e),()=>{this.listeners[t]=this.listeners[t].filter((t=>t!==e))}}}class S{constructor(t){this.store=t,this.sub=null,this.prevState={}}subscirbeComponents(t){this.prevState=this.store.getState(),this.sub=this.store.subscribe((e=>{Object.keys(e).forEach((r=>{var n,i;n=this.prevState[r],i=e[r],("object"==typeof n&&"object"==typeof i?JSON.stringify(n)===JSON.stringify(i):n===i)||t.forEach((t=>{if(t.isWatching(r)){const n={[r]:e[r]};t.storeChanged(n)}}))})),this.prevState=this.store.getState()}))}unsubscirbeFromStore(){this.sub.unsubscribe()}}class ${constructor(t){this.components=t.components||[],this.store=t.store,this.emitter=new w,this.subscriber=new S(this.store)}getRoot(){const t=e.create("div","excel"),r={emitter:this.emitter,store:this.store};return this.components=this.components.map((n=>{const i=e.create("div",n.className),s=new n(i,r);return i.html(s.toHTML()),t.append(i),s})),t}init(){document.addEventListener("contextmenu",c),this.store.dispatch({type:v}),this.subscriber.subscirbeComponents(this.components),this.components.forEach((t=>t.init()))}destroy(){this.subscriber.unsubscirbeFromStore(),this.components.forEach((t=>t.destroy())),document.removeEventListener("contextmenu",c)}}class x{constructor(t,e=[]){if(!t)throw new Error("No $root provided for DOMListener");this.$root=t,this.listeners=e}initDOMListeners(){this.listeners.forEach((t=>{const e=E(t);if(!this[e])throw new Error(`Method ${e} is not implemented in ${this.name}`);this[e]=this[e].bind(this),this.$root.on(t,this[e])}))}removeDOMListeners(){this.listeners.forEach((t=>{const e=E(t);this.$root.off(t,this[e])}))}}function E(t){return"on"+("string"!=typeof(e=t)?"":e.charAt(0).toUpperCase()+e.slice(1));var e}class T extends x{constructor(t,e={}){super(t,e.listeners),this.name=e.name||"",this.emitter=e.emitter,this.subscribe=e.subscribe||[],this.store=e.store,this.unsubscribers=[],this.prepare()}prepare(){}toHTML(){return""}$emit(t,...e){this.emitter.emit(t,...e)}$on(t,e){const r=this.emitter.subscribe(t,e);this.unsubscribers.push(r)}$dispatch(t){this.store.dispatch(t)}storeChanged(){}isWatching(t){return this.subscribe.includes(t)}init(){this.initDOMListeners()}destroy(){this.removeDOMListeners(),this.unsubscribers.forEach((t=>t()))}}class k extends T{constructor(t,e){super(t,{name:"Header",listeners:["input","click"],...e})}prepare(){this.onInput=a(this.onInput,300)}toHTML(){return`\n      <input type="text" class="input" value="${this.store.getState().title||_}" />\n\n      <div>\n\n        <div class="button" data-button="remove">\n          <span class="material-icons" data-button="remove">\n            delete\n          </span>\n        </div>\n\n        <div class="button" data-button="exit">\n          <span class="material-icons" data-button="exit">\n            exit_to_app\n          </span>\n        </div>\n\n\n      </div>\n    `}onClick(t){const n=e(t.target);"remove"===n.data.button?confirm("Вы действительно хотите удалить эту таблицу?")&&(localStorage.removeItem("excel:"+r.param),r.navigate("")):"exit"===n.data.button&&r.navigate("")}onInput(t){const r=e(t.target);var n;this.$dispatch((n=r.text(),{type:f,data:n}))}}!function(t,e,r){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(k,"className","excel__header");class A extends T{constructor(...t){super(...t)}get template(){return JSON.stringify(this.state,null,2)}initState(t={}){this.state={...t}}setState(t){this.state={...this.state,...t},this.$root.html(this.template)}}function L(t){const e=`\n    data-type="button"\n    data-value='${JSON.stringify(t.value)}'\n  `;return`\n    <div class="button ${t.active?"active":""}" ${e}>\n      <span class="material-icons" ${e}>\n        ${t.icon}\n      </span>\n    </div>\n  `}class C extends A{constructor(t,e){super(t,{name:"Toolbar",listeners:["click"],subscribe:["currentStyles"],...e})}prepare(){this.initState(g)}get template(){return[{icon:"format_align_left",active:"left"===(t=this.state).textAlign,value:{textAlign:"left"}},{icon:"format_align_center",active:"center"===t.textAlign,value:{textAlign:"center"}},{icon:"format_align_right",active:"right"===t.textAlign,value:{textAlign:"right"}},{icon:"format_bold",active:"bold"===t.fontWeight,value:{fontWeight:"bold"===t.fontWeight?"normal":"bold"}},{icon:"format_italic",active:"italic"===t.fontStyle,value:{fontStyle:"italic"===t.fontStyle?"normal":"italic"}},{icon:"format_underlined",active:"underline"===t.textDecoration,value:{textDecoration:"underline"===t.textDecoration?"none":"underline"}}].map(L).join("");var t}toHTML(){return this.template}storeChanged(t){this.setState(t.currentStyles)}onClick(t){const r=e(t.target);if("button"===r.data.type){const t=JSON.parse(r.data.value);this.$emit("toolbar:applyStyle",t)}}}!function(t,e,r){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(C,"className","excel__toolbar");class O extends T{constructor(t,e){super(t,{name:"Formula",listeners:["input","keydown"],subscribe:["currentText"],...e})}toHTML(){return'\n      <div class="info">fx</div>\n      <div id="formula" class="input" contenteditable spellcheck="false"></div>\n    '}init(){super.init(),this.$formula=this.$root.find("#formula"),this.$on("table:select",(t=>{this.$formula.text(t.data.value)}))}storeChanged({currentText:t}){this.$formula.text(t)}onInput(t){const r=e(t.target).text();this.$emit("formula:input",r)}onKeydown(t){["Enter","Tab"].includes(t.key)&&(t.preventDefault(),this.$emit("formula:done"))}}!function(t,e,r){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(O,"className","excel__formula");var j=__webpack_require__(781);function P(t,e){return(t[e]||120)+"px"}function N(t,e){return function(r,n){const i=`${e}:${n}`,s=P(t.colState,n),o=t.dataState[i];return`\n      <div \n      class="cell" \n      contenteditable \n      data-col="${n}"\n      data-type="cell"\n      data-id="${i}"\n      data-value="${o||""}"\n      style="${function(t={}){return Object.keys(t).map((e=>{return`${r=e,r.replace(/([A-Z])/g,(t=>`-${t[0].toLowerCase()}`))}: ${t[e]}`;var r})).join("; ")}({...g,...t.stylesState[i]})}; width: ${s}"\n      >${(0,j.Q)(o)||""}</div>\n    `}}function D({col:t,index:e,width:r}){return`\n    <div \n    class="column" \n    data-type="resizable" \n    data-col="${e}" \n    style="width: ${r}"\n    >\n      ${t}\n      <div class="col-resize" data-resize="col"></div>\n    </div>\n  `}function H(t,e,r){const n=e>0?'<div class="row-resize" data-resize="row"></div>':"",i=function(t,e){return(t[e]||24)+"px"}(r,e);return`\n    <div \n      class="row" \n      data-row=${e} \n      data-type="resizable" \n      style="height: ${i}"\n    >\n      <div class="row-info">\n        ${e||""}\n        ${n}\n      </div>\n      <div class="row-data">${t}</div>\n    </div>\n  `}function I(t,e){return String.fromCharCode(65+e)}function M(t){return"cell"===t.target.dataset.type}class R{constructor(){this.group=[],this.current=null}select(t){this.clear(),t.focus().addClass(R.className),this.group.push(t),this.current=t}clear(){this.group.forEach((t=>t.removeClass(R.className))),this.group=[]}get selectedIds(){return this.group.map((t=>t.id()))}selectGroup(t=[]){this.clear(),this.group=t,this.group.forEach((t=>t.addClass(R.className)))}applyStyle(t){this.group.forEach((e=>e.css(t)))}}!function(t,e,r){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(R,"className","selected");class J extends T{constructor(t,e){super(t,{name:"Table",listeners:["mousedown","keydown","input"],...e})}toHTML(){return function(t=15,e={}){const r=[],n=new Array(26).fill("").map(I).map(function(t){return function(e,r){return{col:e,index:r,width:P(t.colState,r)}}}(e)).map(D).join("");r.push(H(n,null,{}));for(let n=0;n<t;n++){const t=new Array(26).fill("").map(N(e,n)).join("");r.push(H(t,n+1,e.rowState))}return r.join("")}(50,this.store.getState())}prepare(){this.selection=new R}init(){super.init(),this.selectCell(this.$root.find('[data-id="0:0')),this.$on("formula:input",(t=>{this.selection.current.attr("data-value",t).text((0,j.Q)(t)),this.updateTextInStore(t)})),this.$on("formula:done",(()=>{this.selection.current.focus()})),this.$on("toolbar:applyStyle",(t=>{var e;this.selection.applyStyle(t),this.$dispatch((e={value:t,ids:this.selection.selectedIds},{type:d,data:e}))}))}selectCell(t){this.selection.select(t),this.$emit("table:select",t);const e=t.getStyles(Object.keys(g));this.$dispatch({type:p,data:e})}async resizeTable(t){try{const r=await function(t,r){return new Promise((n=>{const i=e(r.target),s=i.closest('[data-type="resizable"]'),o=i.data.resize,a=s.data.col,c=s.getCoords(),l="col"===o?"bottom":"right";let u;i.css({opacity:"1",[l]:"-5000px"}),document.onmousemove=t=>{if("col"===o){const e=t.pageX-c.right;u=c.width+e,i.css({right:-e+"px"})}else{const e=t.pageY-c.bottom;u=c.height+e,i.css({bottom:-e+"px"})}},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null,"col"===o?(s.css({width:u+"px"}),t.findAll(`[data-${o}="${a}"]`).forEach((t=>t.style.width=u+"px"))):s.css({height:u+"px"}),n({value:u,type:o,id:s.data[o]}),i.css({opacity:0,bottom:0,right:0})}}))}(this.$root,t);this.$dispatch(function(t){return{type:u,data:t}}(r))}catch(t){console.error(t)}}onMousedown(t){if(function(t){return t.target.dataset.resize}(t))this.resizeTable(t);else if(M){const r=e(t.target);if(t.shiftKey){const t=function(t,e){const r=t.id(!0),n=e.id(!0),i=s(n.col,r.col),o=s(n.row,r.row);return i.reduce(((t,e)=>(o.forEach((r=>t.push(`${r}:${e}`))),t)),[])}(r,this.selection.current).map((t=>this.$root.find(`[data-id="${t}"]`)));this.selection.selectGroup(t)}else this.selectCell(r)}}onKeydown(t){const{key:e}=t;if(["Enter","Tab","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e)&&!t.shiftKey){t.preventDefault();const r=this.selection.current.id(!0),n=this.$root.find(function(t,{col:e,row:r}){switch(t){case"Enter":case"ArrowDown":r++;break;case"Tab":case"ArrowRight":e++;break;case"ArrowLeft":e=e-1<0?0:e-1;break;case"ArrowUp":r=r-1<0?0:r-1}return`[data-id="${r}:${e}"]`}(e,r));this.selectCell(n)}}updateTextInStore(t){var e;this.$dispatch((e={id:this.selection.current.id(),value:t},{type:h,data:e}))}onInput(t){this.updateTextInStore(e(t.target).text())}}!function(t,e,r){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(J,"className","excel__table");class q{constructor(t,e=300){this.client=t,this.listen=a(this.listen.bind(this),e)}listen(t){this.client.save(t)}get(){return this.client.get()}}class z{constructor(t){this.name="excel:"+t}save(t){return o(this.name,t),Promise.resolve()}get(){return new Promise((t=>{const e=o(this.name);setTimeout((()=>{t(e)}),1500)}))}}new class{constructor(t,r){if(!t)throw new Error("Selector is not provided in Router");this.$placeholder=e(t),this.routes=r,this.loader=new n,this.page=null,this.changePageHandler=this.changePageHandler.bind(this),this.init()}init(){window.addEventListener("hashchange",this.changePageHandler),this.changePageHandler()}async changePageHandler(){this.page&&this.page.destroy(),this.$placeholder.clear().append(this.loader);const t=r.path.includes("excel")?this.routes.excel:this.routes.dashboard;this.page=new t(r.param);const e=await this.page.getRoot();this.$placeholder.clear().append(e),this.page.afterRender()}destroy(){window.removeEventListener("hashchange",this.changePageHandler)}}("#app",{dashboard:class extends i{getRoot(){const t=Date.now().toString();return e.create("div","db").html(`\n          <div class="db__header">\n            <h1>Excel. Панель Управления</h1>\n          </div>\n\n          <div class="db__new">\n            <div class="db__view">\n              <a href="#excel/${t}" class="db__create">\n              Новая <br /> Таблица\n              </a>\n            </div>\n          </div>\n\n          <div class="db__table db__view">\n            ${function(){const t=function(){const t=[];for(let e=0;e<localStorage.length;e++){const r=localStorage.key(e);r.includes("excel")&&t.push(r)}return t}();return t.length?`\n    <div class="db__list-header">\n      <span>Название</span>\n      <span>Дата открытия</span>\n    </div>\n\n    <ul class="db__list">\n      ${t.map(l).join("")}\n    </ul>\n  `:"<p>У вас пока нет ни одной таблицы :(</p>"}()}\n          </div>\n      `)}},excel:class extends i{constructor(t){super(t),this.storeSub=null,this.precossor=new q(new z(this.params))}async getRoot(){const t=function(t,e={}){let r=t({...e},{type:"__INIT__"}),n=[];return{subscribe(t){return n.push(t),{unsubscribe(){n=n.filter((e=>e!==t))}}},dispatch(e){r=t(r,e),n.forEach((t=>t(r)))},getState(){return JSON.parse(JSON.stringify(r))}}}(m,(e=await this.precossor.get())?(t=>({...t,currentStyles:g,currentText:""}))(e):(r=y,JSON.parse(JSON.stringify(r))));var e,r;return this.storeSub=t.subscribe(this.precossor.listen),this.excel=new $({components:[k,C,O,J],store:t}),this.excel.getRoot()}afterRender(){this.excel.init()}destroy(){this.excel.destroy(),this.storeSub.unsubscribe()}}})}()})();